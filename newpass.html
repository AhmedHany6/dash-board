<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Title Of The Page -->
    <title>Forgot Password || Metrix</title>

    <!-- Meta Information -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Metrix is a sleek and modern app landing page template built with HTML, CSS, and JavaScript. It's designed to showcase your app's features and attract potential users.">
    <meta name="keywords" content="Metrix - App Landing Page Template, application landing page, application website landing page, responsive website, application responsive website, mobile app landing website, latest bootstrap mobile application website design, product lounch website, app product lounch website, bootstrap template, creative mobile website, multi pages template, landing page website, minimal portfolio, mobile app intro website">
    <meta name="author" content="white orange software">
    <!-- meta og property tags start -->
    <meta property="og:title" content="404 || Metrix" />
    <meta property="og:description" content="Metrix is a sleek and modern app landing page template built with HTML, CSS, and JavaScript. It's designed to showcase your app's features and attract potential users." />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="./assets/images/banner/etfit-index-one-hero-04.png" />
    <meta property="og:URL" content="https://staging.whiteorangesoftware.com/metrix" />
    <!-- meta og property tags end * -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="robots" content="noindex">


    <!-- Favicons -->
    
    <link rel="apple-touch-icon" sizes="72x72" href="/assets/images/favicons/apple-touch-icon.png">
    <link rel="icon" type="images/png" sizes="32x32" href="assets/images/favicons/favicon-32x32.png">
    <link rel="icon" type="images/png" sizes="16x16" href="assets/images/favicons/favicon-16x16.png">
    <link rel="manifest" href="site.webmanifest">
    <link rel="mask-icon" href="/assets/images/favicons/safari-pinned-tab.svg" color="#ffffff">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="theme-color" content="#ffffff">

    <!-- All Css -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <link type="text/css" rel="stylesheet" href="assets/css/styles.css">
    
    
</head>

<body>
    <!-- Spinner Loader Start -->
    <div class="loader">
        <div id="loading-bar-spinner" class="spinner">
            <div class="spinner-icon"></div>
        </div>
    </div>

    <!-- Activity Page Section Starts Here-->
    <section class="activity-bg forget bg-norepeat-cover">
        <div class="container d-flex">
            <div class="activity-card">
                <div class="activity-logo-wrap">
                    <a href="home.html" class="logo-img pb-0">
                        <img src="assets/images/logo/logo.svg" alt="logo-images" />
                    </a>
                </div>
                <div class="activity-card-heading">
                    <h1 class="activity-card-header">Reset Password</h1>
                    <label class="activity-card-subtitle"></p>
                </div>
                <div class="activity-actions activity-actions-forget">
                    <form>
                        <div class="form-group">
                            <i class="fas fa-lock"></i>
                            <input type="password" id="getPassword" class="input-one" placeholder="كلمة المرور">
                        </div>
                        
                        <div class="form-group">
                            <i class="fas fa-lock"></i>
                            <input type="password" id="confirmPassword" class="input-one" placeholder="تأكيد كلمة المرور">
                        </div>
                        
                        <button type="button" class="btn-common btn-verify-small"onclick="window.location.href='login.html'">verify</button>
                    </form>
                </div>
                
            </div>
            <!-- Activity Action Area Ends -->
        </div>
    </section>
    <!-- Activity Page Section Ends Here-->
    <!-- Jquery Javascript File -->
    <script src="assets/js/jquery.min.js"></script>
    <!-- Bootstrap Bundle Javascript File -->
    <script src="assets/js/bootstrap.bundle.min.js"></script>
    <!-- Owl Carousel Javascript File -->
    <script src="assets/js/owl.carousel.min.js"></script>
    <!-- Smooth Scroll Javascript File -->
    <script src="assets/js/smoothscroll.min.js"></script>
    <!-- Default Javascript File -->
    <!-- Customized Javascript File -->
    <script src="assets/js/svg.js"></script>
    <script src="assets/js/custom.js"></script>

    
      <script>
    document.addEventListener("DOMContentLoaded", function() {
        const form = document.getElementById("resetPasswordForm");
        const newPasswordInput = document.getElementById("newPassword");
        const confirmPasswordInput = document.getElementById("confirmPassword");
        const submitButton = form.querySelector("button[type='submit']");

        form.addEventListener("submit", async function(e) {
            e.preventDefault();

            // التحقق من تطابق كلمات المرور
            if (newPasswordInput.value !== confirmPasswordInput.value) {
                alert("كلمة المرور وتأكيدها غير متطابقين");
                return;
            }

            // التحقق من قوة كلمة المرور
            if (newPasswordInput.value.length < 8) {
                alert("كلمة المرور يجب أن تحتوي على 8 أحرف على الأقل");
                return;
            }

            // الحصول على البريد الإلكتروني من localStorage
            const email = localStorage.getItem("emailToVerify");
            if (!email) {
                alert("انتهت صلاحية الجلسة، يرجى إعادة المحاولة");
                window.location.href = "forgot-password.html";
                return;
            }

            // إعداد البيانات للإرسال
            const data = {
                email: email,
                newPassword: newPasswordInput.value,
                newPassword_confirmation: confirmPasswordInput.value
            };

            // تغيير حالة الزر
            submitButton.disabled = true;
            submitButton.textContent = "جاري التحميل...";

            try {
                // 1. إرسال طلب إعادة تعيين كلمة المرور
                const resetResponse = await fetch("https://jobizaa.com/api/admin/password/new-password", {
                    method: "POST",
                    headers: {
                        "Accept": "application/json",
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify(data)
                });

                const resetResult = await resetResponse.json();

                if (!resetResponse.ok) {
                    throw new Error(resetResult.message || "فشل في إعادة تعيين كلمة المرور");
                }

                // 2. تسجيل الدخول تلقائيًا بعد إعادة التعيين
                const loginData = {
                    email: email,
                    password: newPasswordInput.value
                };

                const loginResponse = await fetch("https://jobizaa.com/api/admin/login", {
                    method: "POST",
                    headers: {
                        "Accept": "application/json",
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify(loginData)
                });

                const loginResult = await loginResponse.json();

                if (!loginResponse.ok) {
                    throw new Error(loginResult.message || "فشل في تسجيل الدخول بعد إعادة التعيين");
                }

                // 3. تخزين التوكن للجلسة
                localStorage.setItem("authToken", loginResult.token);
                
                // 4. تنظيف البيانات المؤقتة
                localStorage.removeItem("emailToVerify");
                localStorage.removeItem("resetVerified");
                
                // 5. توجيه إلى صفحة الوظائف
                window.location.href = "jobs.html";
                
            } catch (error) {
                console.error("Error:", error);
                alert(error.message || "حدث خطأ أثناء العملية");
            } finally {
                submitButton.disabled = false;
                submitButton.textContent = "تأكيد";
            }
        });
    });
    </script>
</body>

</html>